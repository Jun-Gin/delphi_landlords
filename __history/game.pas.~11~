unit game;

interface

uses
  System.SysUtils, System.Types, System.UITypes, System.Classes, System.Variants,
  FMX.Types, FMX.Controls, FMX.Forms, FMX.Graphics, FMX.Dialogs, FMX.Memo.Types,
  FMX.ScrollBox, FMX.Memo, FMX.Controls.Presentation, FMX.StdCtrls, System.JSON,
  IdBaseComponent, IdComponent, IdTCPConnection, IdTCPClient, FMX.Edit,uDSimpleTcpClient,
  System.ImageList, FMX.ImgList, FMX.Objects,tcp,login;

type
  TGameInterface = class(TForm)
    Button1: TButton;
    Memo1: TMemo;
    Button2: TButton;
    Memo2: TMemo;
    ImageControl1: TImageControl;
    Image1: TImage;
    Button3: TButton;
    procedure Button1Click(Sender: TObject);
    procedure Button2Click(Sender: TObject);
    procedure FormCreate(Sender: TObject);
    procedure Image1Click(Sender: TObject);
  private
    { Private declarations }
       tMesg:TcpMessage;
  private
    procedure OnSocketRead(AStream: TMemoryStream);
  public
    { Public declarations }
  end;

var
  GameInterface: TGameInterface;


implementation

{$R *.fmx}

procedure TGameInterface.Button1Click(Sender: TObject);
begin

//  ConnectTo('127.0.0.1',51000);
end;


procedure TGameInterface.Button2Click(Sender: TObject);
var str :string;
var
  LStream: TMemoryStream;
  LBytes: TBytes;
  LJson: TJsonObject;
  LStr: TStringStream;
begin

  LStr := TStringStream.Create('', TEncoding.UTF8);
  LJson := TJsonObject.Create;
  LJson.AddPair('key', TJSonString.Create('hello'));


  LStr.WriteString(LJson.ToString);
  LStr.Seek(0, 0);
  LStream := TMemoryStream.Create;
  LStream.CopyFrom(LStr, LStr.Size);


//  FCon.Write(LStream);
  LStream.DisposeOf;
  LJson.DisposeOf;
  LStr.DisposeOf;

end;


procedure TGameInterface.FormCreate(Sender: TObject);
var
  LFrame: TLoginFrame;
begin
    tMesg:=TcpMessage.Create;
    tMesg.ConnectionService();
//  FCon := TConnection.Create;
//  FCon.OnRead := OnSocketRead;
  LFrame := TLoginFrame.Create(Self);
  LFrame.Parent := Self;
  LFrame.BringToFront;

  tMesg.ConnectionService;

end;

procedure TGameInterface.Image1Click(Sender: TObject);
begin
      Image1.Position.Y:=50
end;

procedure TGameInterface.OnSocketRead(AStream: TMemoryStream);
var by :Byte;
var
  LStr: TStringStream;
begin
   LStr := TStringStream.Create('', TEncoding.UTF8);
   LStr.CopyFrom(AStream, AStream.Size);
   Memo2.Lines.Add(LStr.DataString);
   LStr.DisposeOf;
end;

end.
